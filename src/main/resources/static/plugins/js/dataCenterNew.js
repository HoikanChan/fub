function initDataSaMap(){dataSaMap=new Map,totalMap=new Map,$("#satellite_choose").children().each(function(){var e=$(this).attr("id");if($(this).hasClass("no-click")||$(this).addClass("no-click"),$("#"+e+"_i").hasClass("togreen")&&$("#"+e+"_i").removeClass("togreen").addClass("meiyougreen"),e){var t=e.substring(0,e.lastIndexOf("_span"));$(this).hasClass("no-click")||$(this).addClass("no-click"),$("#"+t+"_i").hasClass("togreen")&&$("#"+t+"_i").removeClass("togreen").addClass("meiyougreen"),dataSaMap.put(t,new Map)}})}function setBaseLayers(){tietuLayerMap=new Map,mapOptions={displayProjection:new OpenLayers.Projection("EPSG:4326"),units:"degrees",controls:[],projection:new OpenLayers.Projection("EPSG:4326"),restrictedExtent:restrictedExtentBounds},map=new OpenLayers.Map("map",mapOptions);var e=getBaseLayer(jxResolution);e.params.format="image/jpeg",map.addLayer(e),map.addControl(new OpenLayers.Control.Navigation),map.moveTo(new OpenLayers.LonLat(105.410562,36.209316),4);var t=OpenLayers.Util.getParameters(window.location.href).renderer;vectors2=new OpenLayers.Layer.Vector("Vector Layer 2",{renderers:t,styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style({strokeColor:"#2046fa",strokeOpacity:.3,fillOpacity:0}),select:new OpenLayers.Style({strokeColor:"#fd0505",strokeOpacity:1,fillOpacity:0})})}),map.addLayers([vectors2]),drawCustomExtendVector=new OpenLayers.Layer.Vector("drawExtent",{styleMap:new OpenLayers.StyleMap({default:new OpenLayers.Style({strokeColor:"#bb0000",strokeOpacity:.3,fillColor:"#993300",fillOpacity:.15})})}),map.addLayer(drawCustomExtendVector),selectControl=new OpenLayers.Control.SelectFeature([vectors2],{clickout:!1,toggle:!0,multiple:!0,hover:!1,toggleKey:"ctrlKey",multipleKey:"shiftKey"}),map.addControl(selectControl),selectControl.activate(),void 0!==selectControl.handlers?selectControl.handlers.feature.stopDown=!1:void 0!==selectControl.handler&&(selectControl.handler.stopDown=!1,selectControl.handler.stopUp=!1),vectors2.events.on({featureselected:function(e){var t=e.feature,a=t.fid;showNewDataDetail(a),settietuUrlNaddLayer(a+"thumbnailLayer")},featureunselected:function(e){var t=e.feature,a=t.fid;$("#imageDetail").addClass("dn"),removeonetietu(a+"thumbnailLayer")}})}function showLocationBounds(e){var t=new OpenLayers.Format.GeoJSON,a=t.read(e);drawCustomExtendVector.addFeatures(a),a[0].geometry.calculateBounds(),map.zoomToExtent(a[0].geometry.bounds)}function setCoverLayer(e){e||(e=layerResolutions);var t=new OpenLayers.Layer.WMS("OpenLayers WMS","http://210.77.87.222:8085/geoserver/gwc/service/wms",{layers:"realearth:areamask_jiangxi",styles:"",format:"image/png",transparent:!0},{resolutions:e,tileSize:new OpenLayers.Size(256,256),tileOrigin:new OpenLayers.LonLat(-180,90),transitionEffect:"resize"});map.addLayer(t),map.moveTo(new OpenLayers.LonLat(115.808656,26.774611),6),t.setZIndex(2e3)}function setfeatureBorder(){if(1==loadtodayFlag){var e=NewDate(todayDateStr);e.setDate(e.getDate()),changedailyDate(e.format("yyyy-MM-dd"),null)}}function showChildDataExtend(e){var t=new OpenLayers.Format.GeoJSON,a=t.read(e.range);a[0].fid=e.dataId,vectors2.addFeatures(a[0])}function setTimeList(e){today=NewDate(e),NewDate(e).setDate(today.getDate()-1);var t=new Date;t.setDate(today.getDate()-7);for(var a=t.getMonth()+1,l='<div class="dc-du-date-list fl"><p class="first font12 color333">每日最新</p><p id="dailyUpdateHead" class="second font18 color999">'+today.format("MM-dd")+'</p></div><div class="dc-du-date-select dc-du-date-select1 fl dn"><ul class="li-fl">',i=0;i<7;i++){var r=dateAddDay(t,i);0==i?l+='<li  id="'+r.format("yyyy-MM-dd")+'" onclick="changedailyDate(\''+r.format("yyyy-MM-dd")+'\')"  class="first "><p class="first " >'+(r.getMonth()+1)+'月</p><p class="second ">'+r.getDate()+"</p></li>":a!=r.getMonth()+1?(l+='<li  id="'+r.format("yyyy-MM-dd")+'" onclick="changedailyDate(\''+r.format("yyyy-MM-dd")+'\')" class="first" ><p class="first  ">'+(r.getMonth()+1)+'月</p><p class="second ">'+r.getDate()+"</p></li>",a=r.getMonth()+1):l+='<li  id="'+r.format("yyyy-MM-dd")+'" onclick="changedailyDate(\''+r.format("yyyy-MM-dd")+"')\" >"+r.getDate()+"</li>"}for(var i=0;i<1;i++){var r=new Date;r.setMonth(today.getMonth()),r.setDate(today.getDate()+i),a!=r.getMonth()+1?(l+='<li id="'+r.format("yyyy-MM-dd")+'" onclick="changedailyDate(\''+r.format("yyyy-MM-dd")+'\')"   class="last first active"><p class=" first">'+(r.getMonth()+1)+'月</p><p class="second">'+r.getDate()+"</p></li>",a=r.getMonth()+1):l+='<li id="'+r.format("yyyy-MM-dd")+'" onclick="changedailyDate(\''+r.format("yyyy-MM-dd")+'\')"  class="last active" >'+r.getDate()+"</li>"}$("#dateList").html(l+"</ul>")}function changedailyDate(e,t){showWaiting();var a=api.cloudHost+"dataProduct/onedaynew?";e?$.ajax({url:a,type:"GET",data:{dateStr:e},dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallback",success:function(a){if($("#dailyUpdateHead").html(dateStr2MonthDate(e)),showNselectOperation(a,t),(imageDataNewList=a.list)&&imageDataNewList.length>0){for(var l=0;l<imageDataNewList.length;l++)showChildDataExtend(imageDataNewList[l]),imageDataNewList[l].imageSatelliteType&&newDataSaOperation(imageDataNewList[l]);showNselectOperation(imageDataNewList,imageDataNewList.dataId)}else if(1==loadtodayFlag){var i=NewDate(todayDateStr);i.setDate(i.getDate()-1),$("#"+i.format("yyyy-MM-dd")).addClass("active").siblings().removeClass("active"),changedailyDate(i.format("yyyy-MM-dd"),null)}loadtodayFlag=0}}):hideWaiting(),dateSelectHide(),dataShowFlag=!1}function dateStr2MonthDate(e){var t=e.split("-");return!t||t.length<3?"":t[1]+"-"+t[2]}function showNselectOperation(e,t){if(hideWaiting(),e&&"1"==e.code&&e.list){vectors2.removeAllFeatures(),removetietu(),initDataSaMap();for(var a=0;a<e.list.length;a++)showChildDataExtend(e.list[a]),e.list[a]&&e.list[a]&&e.list[a].imageSatelliteType&&newDataSaOperation(e.list[a]),addtietuMap(e.list[a]);if(satellite_choose,!stringIsNull(t))if(vectors2.getFeatureByFid(t)){var l=map.zoom;selectControl.select(vectors2.getFeatureByFid(t)),map.zoomToExtent(vectors2.getFeatureByFid(t).geometry.bounds),map.moveTo(new OpenLayers.LonLat([map.center.lon,map.center.lat]),l,null)}else alert("该影像超出了最新数据的显示范围！")}}function newDataSaOperation(e){if(dataSaMap.get(e.imageSatelliteType)){var t=dataSaMap.get(e.imageSatelliteType);t.put(e.dataId,e),dataSaMap.put(e.imageSatelliteType,t),totalMap.put(e.dataId,e),$("#"+e.imageSatelliteType+"_i").removeClass("meiyougreen").addClass("togreen"),$("#"+e.imageSatelliteType+"_span").removeClass("no-click")}}function showNewDataDetail(e){if(totalMap.get(e)){var t=totalMap.get(e);if($("#detail_sa").html(t.imageSatelliteType),$("#detail_sa").attr("title",t.imageSatelliteType),100!=t.imageCloudage?($("#detail_cloud").html(t.imageCloudage+"%"),$("#detail_cloud").attr("title",t.imageCloudage+"%")):($("#detail_cloud").html("-"),$("#detail_cloud").attr("title","-")),$("#detail_re").html(t.imageResolution.replace("{","").replace("}","").replace("{","").split(",")[0]+"M"),$("#detail_re").attr("title",t.imageResolution.replace("{","").replace("}","").replace("{","").split(",")[0]+"M"),$("#detail_center").attr("style",""),"PL"==t.imageSatelliteType)$("#detail_center").html(t.name.split("planet_ortho_")[1].split("_")[1]+","+t.name.split("planet_ortho_")[1].split("_")[0]),$("#detail_center").attr("title",t.name.split("planet_ortho_")[1].split("_")[1]+","+t.name.split("planet_ortho_")[1].split("_")[0]);else if("HJ1B"==t.imageSatelliteType||"HJ1A"==t.imageSatelliteType)$("#detail_center").attr("style","display:none;"),$("#detail_center").html(""),$("#detail_center").attr("title","");else if("Terra"==t.imageSatelliteType||"Aqua"==t.imageSatelliteType){var a=t.name.split("_")[1].replace("E","")+"E,"+t.name.split("_")[2].replace("N","")+"N";$("#detail_center").html(a),$("#detail_center").attr("title",a)}else{var l="_";-1==t.name.indexOf(l)&&-1!=t.name.indexOf("-")&&(l="-");var a=t.name.split("_")[2].replace("E","")+"E,"+t.name.split("_")[3].replace("N","")+"N";$("#detail_center").html(a),$("#detail_center").attr("title",a)}$("#imageDetail").removeClass("dn")}}function addNewDatasBySa(e){if(dataSaMap.get(e))for(var t=0;t<dataSaMap.get(e).arr.length;t++)vectors2.getFeatureByFid(dataSaMap.get(e).arr[t].key)||showChildDataExtend(dataSaMap.get(e).arr[t].value)}function deleteNewDatasBySa(e){if(dataSaMap.get(e))for(var t=0;t<dataSaMap.get(e).arr.length;t++)vectors2.getFeatureByFid(dataSaMap.get(e).arr[t].key)&&(vectors2.removeFeatures([vectors2.getFeatureByFid(dataSaMap.get(e).arr[t].key)]),removeonetietu(dataSaMap.get(e).arr[t].key+"thumbnailLayer"))}var map,vectors2,selectControl,imageDataNewList,today,dataSaMap=new Map,totalMap=new Map,jxResolution=[.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.00034332275390625,.000171661376953125,858306884765625e-19,4291534423828125e-20,21457672119140625e-21,10728836059570312e-21,5364418029785156e-21,2682209014892578e-21,1341104507446289e-21,6.705522537231445e-7,3.3527612686157227e-7],restrictedExtentBounds=new OpenLayers.Bounds(121.17565,43.423674,135.089004,53.561485);$(document).ready(function(){setBaseLayers(),showLocationBounds(jxAreaInfo.data.geom),setfeatureBorder()});var satelliters="";$.ajax({url:api.host+"listSatellite",type:"get",data:{type:1},success:function(e){for(var t=0;t<e.list.length;t++){var a=e.list[t].satellite_sensor,l=a.replace(/'/g,'"'),i=JSON.parse(l);for(var r in i)satelliters+="<span id='"+r+"_span' class='no-click'><i class='meiyougreen' id='"+r+"_i'><input type='checkbox' name='ittc'></i><label>"+e.list[t].satellitename+"</label></span>",$("#satellite_choose").html(satelliters)}}});