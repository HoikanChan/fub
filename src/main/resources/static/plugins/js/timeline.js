var timeLine=function(){function e(e,i){$({mark:e})._Ajax({url:"rest/getTimeline",async:!1,success:function(e){if(1==e.code&&e.timeline.length>0){$("#timeLine-content").show(),timeLine.contrastDataArray.length>0&&($("#contrast-list").show(),$("#contrast-note").show()),$("#contrast-img").show(),$("#timeLine").empty();var i=e.timeline,r=new Date("2015/01/01").getTime(),n=(new Date).getTime(),o=0,s=Number(conversionTime(r,"yyyy")),m=Number(conversionTime(r,"MM")),l=(conversionTime(r,"yyyy/MM"),Number(conversionTime(n,"yyyy"))),d=Number(conversionTime(n,"MM"));l=d+2>12?l+1:l,d=d+2>12?d+2-12:d+2;var p=new Date(l+"/"+d+"/1").getTime();o=Math.floor(t(r,p,"month"));for(var h=[],y=o-1,v=0;v<y+1;v++){var f,g;m>12&&(s+=1,m=1),m+1>12?(f=s+1,g=1):(f=s,g=m+1),m=m<10?"0"+m:m,g=g<10?"0"+g:g,h[v]={starttime:s+"/"+m,period:s+"/"+m+"~"+f+"/"+g,month:Number(m),year:s},v==y&&(h[v].lastMonth=Number(g),h[v].lastYear=f),m=Number(m)+1}var b={arr:h},w=template("timeLine-template",b);$("#timeLine").html(w),$("#navigation").height($(document).height()-$("#timeLine-content").outerHeight()-$("#header").outerHeight()-150+"px"),$("#copyright").css("bottom","51px"),$("#timeLine").width($(".node").width()*o),$("#timeLine").css("left",$("#timeLine-center").outerWidth()-$("#timeLine").outerWidth()-20);for(var S=0;S<i.length;S++)if(i[S].starttime==i[S].endtime){var M;M=Number(2==conversionTime(i[S].starttime,"MM"))?28==Number(conversionTime(i[S].starttime,"dd"))||29==Number(conversionTime(i[S].starttime,"dd"))?90:100*(Number(conversionTime(i[S].starttime,"dd"))/30).toFixed(2):31==Number(conversionTime(i[S].starttime,"dd"))||30==Number(conversionTime(i[S].starttime,"dd"))?90:100*(Number(conversionTime(i[S].starttime,"dd"))/30).toFixed(2),i[S].deviation=M;var N=template("point-template",i[S]);$("[data-starttime='"+conversionTime(i[S].starttime,"yyyy/MM")+"']").append(N)}else{var k,x=(conversionTime(i[S].starttime,"yyyy/MM"),conversionTime(i[S].endtime,"yyyy/MM"),$("#timeLine .node").width());k=1==Number(conversionTime(i[S].starttime,"dd"))?0:100*(Number(conversionTime(i[S].starttime,"dd"))/30).toFixed(2),Number(2==conversionTime(i[S].endtime,"MM"))?28==Number(conversionTime(i[S].endtime,"dd"))||29==Number(conversionTime(i[S].endtime,"dd"))?97:100*(Number(conversionTime(i[S].endtime,"dd"))/30).toFixed(2):31==Number(conversionTime(i[S].endtime,"dd"))||30==Number(conversionTime(i[S].endtime,"dd"))?97:100*(Number(conversionTime(i[S].endtime,"dd"))/30).toFixed(2);var E=t(i[S].starttime,i[S].endtime,"month"),C=E*x;i[S].deviation=k,i[S].lineWidth=C;var I=template("line-template",i[S]);$("[data-starttime='"+conversionTime(i[S].starttime,"yyyy/MM")+"']").append(I)}var _=i[i.length-1];timeLine.lastMserviceid=u=_.mapserviceid,L=_.timelineid,_.starttime==_.endtime?$("#timeLine [data-timelineid='"+L+"']").addClass("had-checked-point"):$("#timeLine [data-timelineid='"+L+"']").addClass("had-checked-line"),c(_.timelineid,_.mapserviceid),a(L)}else alert(e.message),$("#timeLine-content").hide(),$("#checkReport-btn").hide(),$("#baseMapSelect-list").html(""),$("#legend").hide(),$("#contrast-div").children().hide()}})}function t(e,t,a){var i,r=parseInt((t-e)/1e3);switch(a){case"year":i=r/86400/365;break;case"month":i=r/86400/30;break;case"day":i=r/86400;break;case"hour":i=r/3600;break;case"minute":i=r/60;break;case"second":i=r}return i}function a(e){var t=$("#timeLine [data-timelineid="+e+"]").offset().left,a=$("#timeLine [data-timelineid="+e+"]").outerWidth(),i=$("#timeLine-left-arrow").outerWidth(),r=(Math.abs($("#timeLine").offset().left),$("#timeLine-center").outerWidth());(t/(r+i)<.9||t/(r+i)>=1)&&($("#timeLine").css("left",$("#timeLine").position().left+i-t),t=$("#timeLine [data-timelineid="+e+"]").offset().left,$("#timeLine").css("left",$("#timeLine").position().left+.85*r-(t-i)),a>.15*r&&$("#timeLine").css("left",$("#timeLine").position().left-(a-.15*r)-20))}function i(e,t){y=e.srs,timeLine.map?r():(timeLine.map=new SuperMap.Map("map",{controls:[new SuperMap.Control.Navigation]}),timeLine.map.allOverlays=!0);var a=e.bounds.split(",");if(a=a.map(function(e){return Number(e)}),t)if(timeLine.baseMapLayer=[],t.map(function(a,i){var r=t[i].bounds.split(",");r=r.map(function(e){return Number(e)});var n=new SuperMap.Bounds(r[0],r[1],r[2],r[3]);y!=t[i].srs&&(n=n.transform(new SuperMap.Projection(t[i].srs),new SuperMap.Projection(y)));var o=new SuperMap.Layer.WMS(t[i].name,t[i].service_url,{layers:t[i].layers,format:t[i].format,transparent:!0},{projection:y,resolutions:e.res?JSON.parse(t[i].res):m(y,Number(t[i].resnums.split(",")[0]),Number(t[i].resnums.split(",")[1])),maxExtent:n,isBaseLayer:!0,visibility:!i});timeLine.baseMapLayer.push(o),timeLine.map.addLayer(o)}),timeLine.currentBaseLayer=timeLine.baseMapLayer[1],h||null==$.getUrlParam("centerX")||void 0==$.getUrlParam("centerX")||null==$.getUrlParam("centerY")||void 0==$.getUrlParam("centerY")||null==$.getUrlParam("zoom")||void 0==$.getUrlParam("zoom"))timeLine.map.zoomToExtent(new SuperMap.Bounds(timeLine.baseMapLayer[0].maxExtent.left,timeLine.baseMapLayer[0].maxExtent.bottom,timeLine.baseMapLayer[0].maxExtent.right,timeLine.baseMapLayer[0].maxExtent.top));else{var i=Number($.getUrlParam("centerX")),c=Number($.getUrlParam("centerY")),d=Number($.getUrlParam("zoom"));timeLine.map.setCenter(new SuperMap.LonLat(i,c),d,!1,!1),h++}else if(h||null==$.getUrlParam("centerX")||void 0==$.getUrlParam("centerX")||null==$.getUrlParam("centerY")||void 0==$.getUrlParam("centerY")||null==$.getUrlParam("zoom")||void 0==$.getUrlParam("zoom"))timeLine.map.zoomToExtent(new SuperMap.Bounds(a[0],a[1],a[2],a[3]));else{var i=Number($.getUrlParam("centerX")),c=Number($.getUrlParam("centerY")),d=Number($.getUrlParam("zoom"));timeLine.map.setCenter(new SuperMap.LonLat(i,c),d,!1,!1),h++}var p=null;p="supermapwms111"==e.type.toLowerCase()&&-1!=e.layers.indexOf(";")?e.layers.split(";")[0]:e.layers,timeLine.mainLayer=new SuperMap.Layer.WMS(e.name,e.service_url,{layers:p,format:e.format,transparent:!0},{projection:e.srs,resolutions:e.res?JSON.parse(e.res):m(e.srs,Number(e.resnums.split(",")[0]),Number(e.resnums.split(",")[1])),maxExtent:new SuperMap.Bounds(a[0],a[1],a[2],a[3]),isBaseLayer:!1,visibility:!0}),timeLine.roadNetworkLayer||(timeLine.roadNetworkLayer=l("cia_w",!1,!0)),timeLine.map.addLayers([timeLine.mainLayer,timeLine.roadNetworkLayer]),$("#roadNetwork-btn").hasClass("active")||timeLine.roadNetworkLayer.setVisibility(!1),timeLine.map.addLayer(s(g,!1)),timeLine.map.events.unregister("move"),timeLine.map.events.register("move","#map",function(e){$("#navigation ul").hide(),$("#toolsBar ul").hide(),$("#baseMapSelect ul").hide()}),"supermapwms111"==e.type.toLowerCase()?window.stt=f.init(timeLine.map,e.service_url,e.layers,e.name,o):n()}function r(){timeLine.map.layers.length>0&&(timeLine.map.layers.map(function(e){timeLine.map.removeLayer(e)}),r())}function n(){var e=new SuperMap.Layer.Vector("Highlighted Features",{displayInLayerSwitcher:!1,isBaseLayer:!1});timeLine.map.addLayer(e);var t=new SuperMap.Format.GeoJSON;timeLine.map.events.unregister("click"),timeLine.map.events.register("click",map,function(a){$("#navigation ul").hide(),$("#toolsBar ul").hide(),$("#baseMapSelect ul").hide(),v&&timeLine.map.removePopup(v)&&v.destroy()&&(v=void 0),e.destroyFeatures();var i=a.xy,r={SERVICE:"WMS",REQUEST:"GetFeatureInfo",VERSION:timeLine.mainLayer.params.VERSION,EXCEPTIONS:timeLine.mainLayer.params.EXCEPTIONS,BBOX:timeLine.map.getExtent().toBBOX(null,timeLine.mainLayer.reverseAxisOrder()),INFO_FORMAT:"application/json",QUERY_LAYERS:timeLine.mainLayer.params.LAYERS,FEATURE_COUNT:1,LAYERS:timeLine.mainLayer.params.LAYERS,STYLES:timeLine.mainLayer.params.STYLES,WIDTH:timeLine.map.size.w,HEIGHT:timeLine.map.size.h,FORMAT:timeLine.mainLayer.params.FORMAT};SuperMap.Util.extend(r,parseFloat(timeLine.mainLayer.params.VERSION)>=1.3?{CRS:timeLine.mainLayer.params.SRS,i:parseInt(i.x),j:parseInt(i.y)}:{SRS:timeLine.mainLayer.params.SRS,x:parseInt(i.x),y:parseInt(i.y)}),SuperMap.Element.addClass(timeLine.map.viewPortDiv,"olCursorWait"),r.url=timeLine.mainLayer.url,SuperMap.Request.OPTIONS({url:timeLine.mainLayer.url,params:r,callback:function(a){SuperMap.Element.removeClass(timeLine.map.viewPortDiv,"olCursorWait");var r=a.responseXML;r&&r.documentElement||(r=a.responseText);var n=t.read(r);if(n&&n.length>0){e.addFeatures(n);for(var o=n[0],s=["Id","border_col","border_wid","fill_col","opacity_bo","opacity_fi"],m=0;m<s.length;m++)delete o.attributes[s[m]];var l="<br><table style='text-align:center'><tbody>";for(var c in o.attributes)l+="<tr><td>"+c+":</td><td>"+o.attributes[c]+"</td></tr>";l+="</tbody><table>",e.addFeatures(o),v=new SuperMap.Popup.FramedCloud("信息",timeLine.map.getLonLatFromPixel(i),null,l,null,!0,function(){e.destroyFeatures(),timeLine.map.removePopup(v)&&v.destroy()&&(v=void 0)}),timeLine.map.addPopup(v)}}}),SuperMap.Event.stop(a)})}function o(e,t){var a={strokeColor:"#304DBE",strokeWidth:1,pointerEvents:"visiblePainted",fillColor:"#304DBE",fillOpacity:.5};if(t){e.removeHighlightFeature(),t.style=a,e.highlightLayer.addFeatures(t),v&&timeLine.map.removePopup(v)&&v.destroy()&&(v=void 0);var i="<br><table style='text-align:center;width:200px,height:200px'><tbody>";for(var r in t.attributes)i+="<tr><td>"+r+":</td><td>"+t.attributes[r]+"</td></tr>";i+="</tbody><table>",v=new SuperMap.Popup.FramedCloud("信息",timeLine.map.getLonLatFromPixel({x:e.position.x,y:e.position.y}),null,i,null,!0,function(){e.removeHighlightFeature(),e.map.removePopup(v)&&v.destroy()&&(v=void 0)}),e.map.addPopup(v)}}function s(e,t){if(!e)return void console.log("图层参数为空，请检查！");var a=new SuperMap.Bounds(-20037508.342787,-20037508.342787,20037508.342787,20037508.342787),i=new SuperMap.Bounds(-180,-90,180,90),r="EPSG:3857"==e.projection?a:i;return e.bkcolor&&(e.ENV+=";bkcolor:"+e.bkcolor),new SuperMap.Layer.WMS(e.title||"遮罩层",e.url,{layers:e.layers,format:e.format||"image/png",ENV:e.ENV,transparent:!0},{projection:new SuperMap.Projection(e.projection),numZoomLevels:e.numZoomLevels||20,maxExtent:r,isBaseLayer:!!t,wrapDateLine:!!e.wrapDateLine,visibility:!!e.visibility})}function m(e,t,a,i,r){t|=0,a|=0,e=e||"EPSG:3857",0===a&&(a="EPSG:4326"==e?18:19),i=i||2;var n=0;if(void 0==r){var r=zkygMap.base.calcResBegin[e];n="EPSG:4326"==e?1:0}for(var o=[],s=t;s<=a;s++){var m=s+n;o.push(r/Math.pow(2,m))}return o}function l(e,t,a,i){var r=[.703125,.3515625,.17578125,.087890625,.0439453125,.02197265625,.010986328125,.0054931640625,.00274658203125,.001373291015625,.0006866455078125,.0003433227539062,.0001716613769531,858306884766e-16,429153442383e-16,214576721191e-16,107288360596e-16,53644180298e-16,26822090149e-16,13411045074e-16,6.705522537e-7,3.352761269e-7],n=[156543.03394950466,78271.51697475233,39135.758487376166,19567.879243688083,9783.939621844042,4891.969810922021,2445.9849054610104,1222.9924527305052,611.4962263652526,305.7481131826263,152.87405659131315,76.43702829565657,38.21851414782829,19.109257073914144,9.554628536957072,4.777314268478536,2.388657134239268,1.194328567119634,.597164283559817],o={c:r.slice(0,18),w:n.slice(0,18)};e=e||"vec_c";var s="";switch(e){case"vec_c":s="街道地图_WGS84";break;case"img_c":s="影像地图_WGS84";break;case"ter_c":s="地形地图_WGS84";break;case"cva_c":s="中文标注_WGS84";break;case"eva_c":s="英文标注_WGS84";break;case"cia_c":s="影像中文标注_WGS84";break;case"eia_c":s="影像英文标注_WGS84";break;case"cta_c":s="地形中文标注_WGS84";break;case"vec_w":s="街道地图_Web墨卡托";break;case"img_w":s="影像地图_Web墨卡托";break;case"ter_w":s="地形地图_Web墨卡托";break;case"cva_w":s="中文标注_Web墨卡托";break;case"eva_w":s="英文标注_Web墨卡托";break;case"cia_w":s="影像中文标注_WGS84";break;case"eia_w":s="影像英文标注_Web墨卡托";break;case"cta_w":s="地形中文标注_Web墨卡托";break;default:e="vec_c",s="街道地图_WGS84"}for(var m="http://t0.tianditu.com/"+e+"/wmts",l=e.split("_"),c=l[0],d=l[1],p="c"==d?"EPSG:4326":"EPSG:3857",u="c"==d?"degrees":"m",L=o[d],h="c"==d?L:L.slice(1),y="c"==d?new SuperMap.LonLat(-180,90):new SuperMap.LonLat(-20037508.3428,20037508.3428),v="c"==d?new SuperMap.Bounds(-180,-90,180,90):new SuperMap.Bounds(-20037508.3428,-20037508.3428,20037508.3428,20037508.3428),f=new Array,$=1;$<19;++$)"c"==d?f[$-1]=""+$:"w"==d&&(f[$-1]=""+($-1));return new SuperMap.Layer.WMTS({name:s,url:m,layer:c,matrixSet:d,matrixIds:f,style:"default",isBaseLayer:!!t,visibility:!!a,format:"tiles",projection:p,units:u,resolutions:L,serverResolutions:h,transitionEffect:"resize",wrapDateLine:!!i,tileSize:new SuperMap.Size(256,256),tileOrigin:y,tileFullExtent:v})}function c(e,t){$({timelineid:e})._Ajax({url:"rest/getMapServiceInfoById",success:function(t){if(1==t.code){if(i(t.mServieMap,t.baseMapInfoList),t.baseMapInfoList){t.timelineid=e;var a=template("baseMap-template",t);$("#baseMapSelect-list").html(a),$("#baseMapSelect-list li").eq(0).addClass("active")}else $("#baseMapSelect-list").html("");t.mServieMap.legend?$("#legend").show().find("img").attr("src",t.mServieMap.legend).hide():$("#legend").hide().find("img").attr("src","")}else alert(t.msg)}}),d(t)}function d(e){$({mapServiceId:e})._Ajax({url:"rest/getSubjectiveReportInfo",async:!1,success:function(e){1==e.code&&e.subjectiveReportMap&&(e.subjectiveReportMap.downloadurl?$("#checkReport-btn").attr("data-href",e.subjectiveReportMap.downloadurl.replace("outLinkFile","onlineLook")).show():$("#checkReport-btn").attr("data-href","").hide())}})}var p,u,L,h,y;$(window).outerWidth();$("#mapcenter").height($(window).outerHeight()-$("#header").outerHeight()),$(window).resize(function(){$("#mapcenter").height($(window).outerHeight()-$("#header").outerHeight())});var v=void 0,f={};f.init=function(e,t,a,i,r){var n=new SuperMap.Layer.Vector("Vector Layer1",{displayInLayerSwitcher:!1}),o=new SuperMap.Layer.Markers("Markers",{displayInLayerSwitcher:!1});if(e.events.on({click:f.drawCompleted}),e.addLayers([n,o]),f.highlightLayer=n,f.markerLayer=o,f.highlightLayerCallback=r,f.map=e,f.name=i,f.url=t.split("wms111")[0].replace(/map/g,"data")+"rest/data",a.indexOf(";")>0){var s=a.split(";");if(s[1].indexOf(":")>0)f.datasetNames=[s[1]];else{var m=s[1],l=m.length>30?m.substring(0,30):m;l=l.replace(/-/g,"_"),f.datasetNames=[m+":"+l]}}else a.indexOf("@")>0?f.datasetNames=[a.split("@")[1]+":"+a.split("@")[0]]:console.warn("源数据保存在地图中的名称已修改，请检查！");return f},f.drawCompleted=function(e){var t=f.map.getLayersByName(f.name)[0];if(!t||t.getVisibility()){f.position={x:e.x,y:e.y};var a=f.map.getLonLatFromPixel(new SuperMap.Pixel(e.x,e.y)),i=new SuperMap.Geometry.Point(a.lon,a.lat);i.bounds=new SuperMap.Bounds(a.lon,a.lat,a.lon,a.lat);var r,n;if(0==f.datasetNames.length)return void console.warn("查询图层为空，请检查！");r=new SuperMap.REST.GetFeaturesByGeometryParameters({datasetNames:f.datasetNames,toIndex:-1,spatialQueryMode:SuperMap.REST.SpatialQueryMode.INTERSECT,geometry:i}),n=new SuperMap.REST.GetFeaturesByGeometryService(f.url,{eventListeners:{processCompleted:f.processCompleted,processFailed:f.processFailed}}),n.processAsync(r)}},f.processCompleted=function(e){var t,a,i=e.result;if(i&&i.recordsets){for(t=0,recordsets=i.recordsets,len=recordsets.length;t<len;t++)if(recordsets[t].features)for(a=0;a<recordsets[t].features.length;a++){var r=recordsets[t].features[a],n=r.geometry;if(n.CLASS_NAME==SuperMap.Geometry.Point.prototype.CLASS_NAME){var o=new SuperMap.Size(44,33),s=new SuperMap.Pixel(-o.w/2,-o.h),m=new SuperMap.Icon("../theme/images/marker.png",o,s);markerLayer.addMarker(new SuperMap.Marker(new SuperMap.LonLat(n.x,n.y),m))}else f.highlightLayerCallback(f,r)}}else if(i&&i.features)for(a=0,features=i.features;a<features.length;a++){var r=features[a],n=r.geometry;if(n.CLASS_NAME==SuperMap.Geometry.Point.prototype.CLASS_NAME){var o=new SuperMap.Size(44,33),s=new SuperMap.Pixel(-o.w/2,-o.h),m=new SuperMap.Icon("../theme/images/marker.png",o,s);markerLayer.addMarker(new SuperMap.Marker(new SuperMap.LonLat(n.x,n.y),m))}else f.highlightLayerCallback(f,r)}},f.processFailed=function(e){console.warn(e.error.errorMsg)},f.removeHighlightFeature=function(e){f.highlightLayer&&f.highlightLayer.removeAllFeatures()},f.removeMarker=function(){f.markerLayer.clearMarkers()};var g={title:"遮罩层",url:"http://210.77.87.225:8082/geoserver/realearth/wms",layers:"realearth:areamask",format:"image/png",ENV:"id:230300",bkcolor:"212c48",projection:"EPSG:3857",wrapDateLine:!1,visibility:!0,numZoomLevels:20};return{init:function(){$(document).on("click","#timeLine .layersImg",function(){c($(this).attr("data-timelineid"),$(this).attr("data-mapserviceid")),$("#timeLine").find(".had-checked-point").removeClass("had-checked-point").end().find(".had-checked-line").removeClass("had-checked-line"),$(this).hasClass("point")?$(this).addClass("had-checked-point"):$(this).hasClass("line")&&$(this).addClass("had-checked-line")}),$(document).on("mouseover","#timeLine .layersImg",function(e){var t=$("#layersImg-timeNote"),a=$(this);t.stop().show().css("opacity",100).find("p").html(a.attr("data-displayname"));var i=a.offset().left+a.outerWidth()/2-$("#layersImg-timeNote").outerWidth()/2,r=$("#timeLine-content").outerHeight()+10;if(a.offset().left+a.outerWidth()/2<=$("#timeLine-left-arrow").outerWidth()||a.offset().left+a.outerWidth()/2>=$("#timeLine-right-arrow").offset().left)return t.hide(),!1;t.css({left:i+"px",bottom:r+"px"}).show(),$(this).css("z-index",2010);var n=t.find("div");if(n.show(),n.html("加入对比").addClass("contrast-btn").removeClass("cancel-contrast-btn"),n.attr({"data-mapserviceid":a.attr("data-mapserviceid"),"data-timelineid":a.attr("data-timelineid"),"data-displayname":a.attr("data-displayname")}),timeLine.contrastDataArray.length>0)for(var o=0;o<timeLine.contrastDataArray.length;o++)timeLine.contrastDataArray[o].timelineid==a.attr("data-timelineid")&&n.html("取消").addClass("cancel-contrast-btn").removeClass("contrast-btn")}),$(document).on("mouseout","#timeLine .layersImg",function(e){$(this);$(this).css("z-index","30"),$("#layersImg-timeNote").animate({opacity:"0"},2e3,function(){$("#layersImg-timeNote").css({opacity:100,display:"none"})})}),$(document).on("mouseover","#layersImg-timeNote",function(e){$("#layersImg-timeNote").css("opacity",100).stop().show()}),$(document).on("mouseout","#layersImg-timeNote",function(e){$("#layersImg-timeNote").animate({opacity:"0"},2e3,function(){$("#layersImg-timeNote").css({opacity:100,display:"none"})})}),$(document).on("click","#timeLine-right-arrow",function(){var e=$("#timeLine").position().left;$("#timeLine").outerWidth()+$("#timeLine").offset().left-$("#timeLine-left-arrow").outerWidth()>$("#timeLine-center").outerWidth()-20&&$("#timeLine").stop().animate({left:e-100+"px"})}),$(document).on("mousedown","#timeLine-right-arrow",function(){function e(e){var t=$("#timeLine").position().left;$("#timeLine").outerWidth()+$("#timeLine").offset().left-$("#timeLine-left-arrow").outerWidth()>$("#timeLine-center").outerWidth()-20?$("#timeLine").stop().animate({left:t-10+"px"},5):clearInterval(p)}p=setInterval(e,50)}),$(document).on("mouseup","#timeLine-right-arrow",function(){clearInterval(p)}),$(document).on("click","#timeLine-left-arrow",function(){var e=$("#timeLine").position().left;$("#timeLine").offset().left<$("#timeLine-center").offset().left+40&&$("#timeLine").stop().animate({left:e+100+"px"})}),$(document).on("mousedown","#timeLine-left-arrow",function(){function e(e){var t=$("#timeLine").position().left;$("#timeLine").offset().left<$("#timeLine-center").offset().left+40?$("#timeLine").stop().animate({left:t+10+"px"},5):clearInterval(p)}p=setInterval(e,50)}),$(document).on("mouseup","#timeLine-left-arrow",function(){clearInterval(p)}),$(document).on("click","#layersImg-timeNote .contrast-btn",function(){$(this).html("取消").addClass("cancel-contrast-btn").removeClass("contrast-btn"),$("#contrast-div #contrast-img").find("i").addClass("ichoice");var e=$(".layersImg[data-timelineid='"+$(this).attr("data-timelineid")+"']"),t={timelineid:$(this).attr("data-timelineid"),displayName:$(this).attr("data-displayname")};e.hasClass("had-checked-line")||e.hasClass("had-point-line")?t.baseMapId=$("#baseMapSelect-list .active").attr("data-id"):t.baseMapId="",timeLine.contrastDataArray.push(t),timeLine.contrastDataArray.length>2&&(timeLine.contrastDataArray.splice(0,1),$("#contrast-list").find("li").eq(0).remove()),$("#contrast-div .count").html(timeLine.contrastDataArray.length);var a="<li data-timelineid='"+$(this).attr("data-timelineid")+"'><span class='contrast-title' title="+$(this).attr("data-displayname")+">"+$(this).attr("data-displayname")+"</span><span  class='cancel-contrast-btn' data-timelineid='"+$(this).attr("data-timelineid")+"'></span></li>";$("#contrast-list").append(a).show().siblings("#contrast-note").show()}),$(document).on("click","#contrast-div #contrast-img",function(){$("#contrast-note").animate({opacity:1},"fast",function(){$(this).show()})}),$(document).on("click","#contrast-note button",function(e){if(timeLine.contrastDataArray.length<2)return alert("在下方时间轴上选择两期影像后点击对比按钮"),!1;var t=timeLine.contrastDataArray;localStorage.setItem("contrastMapData",JSON.stringify(t)),window.open("mapContrast.html")}),$(document).on("click","#contrast-note .close-btn",function(){$("#contrast-note").animate({opacity:0},"fast",function(){$(this).hide()})}),$(document).on("click",".cancel-contrast-btn",function(){if($(this).closest("#contrast-list").length>0?($(this).parent().remove(),$(this).attr("data-timelineid")==$("#layersImg-timeNote .cancel-contrast-btn").attr("data-timelineid")&&$("#layersImg-timeNote .cancel-contrast-btn").html("对比").addClass("contrast-btn").removeClass("cancel-contrast-btn")):($(this).html("对比").addClass("contrast-btn").removeClass("cancel-contrast-btn"),$("#contrast-list li[data-timelineid='"+$(this).attr("data-timelineid")+"']").remove()),1==timeLine.contrastDataArray.length)timeLine.contrastDataArray.length=0;else for(var e=0;e<timeLine.contrastDataArray.length;e++)timeLine.contrastDataArray[e].timelineid==$(this).attr("data-timelineid")&&timeLine.contrastDataArray.splice(e,1);0==timeLine.contrastDataArray.length&&($("#contrast-div .ichoice").removeClass("ichoice"),$("#contrast-list").hide()),$("#contrast-div .count").html(timeLine.contrastDataArray.length)})},map:null,getTimeline:e,mapLayerData:{},baseMapLayer:[],mainLayer:null,currentBaseLayer:null,roadNetworkLayer:null,lastMserviceid:null,getLayerShow:a,contrastDataArray:[]}}();timeLine.init();